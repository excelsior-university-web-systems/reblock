(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,o=JSON.parse('{"apiVersion":3,"name":"reblock/reblock-block-selector","title":"ReBlock","description":"Insert reusable block content.","version":"1.0.0","category":"reblock-blocks","supports":{"html":false,"multiple":true,"inserter":true,"reusable":false,"transform":false},"attributes":{"blockId":{"type":"number","default":0},"blockTitle":{"type":"string","default":""},"hasExcelsiorBootstrap":{"type":"boolean","default":false},"useIframe":{"type":"boolean","default":false}},"editorScript":"file:./index.js","editorStyle":"file:./editor.css"}'),r=window.wp.blockEditor,l=window.wp.components,s=window.wp.data,n=window.wp.element,a=window.wp.apiFetch;var c=e.n(a);const i=window.lodash,d=window.wp.primitives,u=window.ReactJSXRuntime,p=(0,u.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(d.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),h=(0,u.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(d.Path,{d:"m11.3 17.2-5-5c-.1-.1-.1-.3 0-.4l2.3-2.3-1.1-1-2.3 2.3c-.7.7-.7 1.8 0 2.5l5 5H7.5v1.5h5.3v-5.2h-1.5v2.6zm7.5-6.4-5-5h2.7V4.2h-5.2v5.2h1.5V6.8l5 5c.1.1.1.3 0 .4l-2.3 2.3 1.1 1.1 2.3-2.3c.6-.7.6-1.9-.1-2.5z"})});(0,t.registerBlockType)(o,{icon:{src:(0,u.jsx)("svg",{id:"a",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:(0,u.jsx)("path",{d:"M28,0H4C1.79,0,0,1.79,0,4v24c0,2.21,1.79,4,4,4h24c2.21,0,4-1.79,4-4V4c0-2.21-1.79-4-4-4ZM17.11,26.84s-.04,0-.06,0c-5.99.57-11.31-3.82-11.88-9.81-.25-2.6.45-5.21,1.96-7.34l-1.99-1.99c-.07-.08-.12-.17-.13-.28-.02-.25.16-.47.41-.49l5.55-.51s.05,0,.08,0c.25.02.43.24.41.49l-.51,5.55c0,.11-.06.2-.13.28-.18.18-.46.18-.64,0l-1.75-1.75c-2.76,4.19-1.61,9.82,2.58,12.58,1.73,1.14,3.8,1.66,5.86,1.46.5-.06.95.29,1.02.78.06.5-.29.95-.78,1.02ZM26.88,24.94c-.08.08-.17.12-.28.13l-5.55.51c-.25.02-.47-.16-.49-.41,0-.03,0-.05,0-.08l.51-5.55c.02-.25.24-.43.49-.41.11,0,.2.06.28.13l1.74,1.74c2.32-3.59,1.89-8.38-1.14-11.41-1.99-1.99-4.68-2.87-7.28-2.62-.5.06-.95-.29-1.02-.78-.06-.5.29-.95.78-1.02.02,0,.04,0,.06,0,5.99-.57,11.31,3.82,11.88,9.81.25,2.57-.5,5.21-1.98,7.33l2,2c.18.18.18.46,0,.64Z",style:{fill:"#77008d"}})})},edit:function({attributes:e,setAttributes:t,clientId:o}){const{blockId:a,blockTitle:d,hasExcelsiorBootstrap:b,useIframe:x,metadata:m}=e,f=(0,r.useBlockProps)({}),[w,k]=(0,n.useState)(null),[g,v]=(0,n.useState)(0),[B,_]=(0,n.useState)(null),[j,S]=(0,n.useState)([{value:a,label:d}]),[y,R]=(0,n.useState)(a),[C,T]=(0,n.useState)(""),I=`${a}-${g}`,P=(0,s.useSelect)((e=>{const{getBlockParents:t,getBlock:r}=e("core/block-editor");return t(o).some((e=>{const t=r(e);return"excelsior-bootstrap-editor/container"===t?.name}))}),[o]),E=(0,s.useSelect)((e=>{const t=e("core/editor")?.getCurrentPostType?.();return"excelsior_bootstrap"===t}),[]),F=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta")||{}),[]),N=(Array.isArray(F._reblock_used_in)?F._reblock_used_in:[]).filter((e=>"reblock"==e.type));(0,n.useEffect)((()=>{E&&t({useIframe:!0})}),[E]);const M=(0,i.debounce)((async e=>{let t=`/wp/v2/reblock?search=${e}&per_page=10&status=publish`;if("reblock"===wp.data.select("core/editor").getCurrentPostType()){const e=[wp.data.select("core/editor").getCurrentPostId()];N.forEach((t=>{e.push(t.id)}));const o=await(async e=>{const t=new Set,o=[...e];for(;o.length>0;){const e=o.pop();if(!t.has(e)){t.add(e);try{var r;const l=await c()({path:`/wp/v2/reblock/${e}`}),s=(null!==(r=l.meta?._reblock_used_in)&&void 0!==r?r:[]).filter((e=>"reblock"===e.type)).map((e=>e.id));for(const e of s)t.has(e)||o.push(e)}catch(t){console.warn(`Failed to load ReBlock ${e}`,t)}}}return Array.from(t)})(e);t+=`&exclude=${o.join(",")}`}c()({path:t}).then((e=>{const t=e.map((e=>({value:e.id,label:e.title.rendered})));S(t),_(null)})).catch((e=>{_("Failed to search ReBlock. "+e.message)}))}),500);(0,n.useEffect)((()=>{a||M("")}),[]),(0,n.useEffect)((()=>{a&&c()({path:`/wp/v2/reblock/${a}`}).then((e=>{const o=O(e.content.rendered);"publish"==e.status?(e.content.rendered=o,k(e),m?m.name&&m.name!=e.title.rendered&&t({metadata:{...m,name:e.title.rendered}}):t({metadata:{name:e.title.rendered}}),_(null)):_(`The requested ReBlock (ID: ${a}) could not be found. Please ensure that it exists and has been published.`)})).catch((e=>{k(null),_("There was an error fetching the ReBlock content. "+e.message)}))}),[I]);const D=e=>{const t=j.filter((t=>t.value==e));return t.length?t[0].label:""},V=e=>{!e&!a||(e||(e=D(a)),T(e),M(e))},H=e=>{R(e),t({blockId:Number(e),blockTitle:D(e)})},O=e=>{if(P){const o=(new DOMParser).parseFromString(e,"text/html"),r=o.querySelector("#excelsior-bootstrap");if(r){const e=r.querySelector(".page-container");if(e){for(;e.firstChild;)r.parentNode.insertBefore(e.firstChild,r);e.remove(),b||t({hasExcelsiorBootstrap:!0})}return r.remove(),o.body.innerHTML}}return b&&t({hasExcelsiorBootstrap:!1}),e};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(n.Fragment,{children:(0,u.jsxs)(r.BlockControls,{children:[(0,u.jsx)(l.ToolbarGroup,{children:(0,u.jsx)(l.ToolbarButton,{className:"reblock-disabled-btn-title",description:"A ReBlock content "+(w?" from "+w.title.rendered:""),variant:"tertiary",__next40pxDefaultSize:!0,text:w?w.title.rendered:"ReBlock",disabled:!0})}),(0,u.jsxs)(l.ToolbarGroup,{children:[(0,u.jsx)(l.ToolbarButton,{href:"/wp-admin/post.php?post="+w?.id+"&action=edit",target:"_blank",__next40pxDefaultSize:!0,icon:p,text:"Edit Original",disabled:!w}),(0,u.jsx)(l.ToolbarButton,{__next40pxDefaultSize:!0,icon:h,text:"Refresh",onClick:()=>{v((e=>e+1))},disabled:!w})]})]})}),(0,u.jsx)(r.InspectorControls,{children:(0,u.jsxs)(l.PanelBody,{title:"ReBlock Settings",children:[(0,u.jsx)(l.ComboboxControl,{label:"ReBlock",help:"To prevent direct or indirect circular references (i.e., infinite loops), ReBlock posts that reference this current ReBlock post are excluded from search.",value:y,onChange:H,onFilterValueChange:V,options:j,renderItem:e=>(0,u.jsx)("span",{children:e.label}),placeholder:"Search",allowReset:!1,expandOnFocus:!1,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,u.jsx)(l.__experimentalSpacer,{as:"div"}),(0,u.jsx)(l.ToggleControl,{label:"Embed via iFrame",help:!E&&"Toggle on to show this ReBlock content outside WordPress, or to allow circular references (rare occurrence).",checked:x,disabled:E,__nextHasNoMarginBottom:!0,onChange:e=>t({useIframe:e})}),E&&(0,u.jsx)(l.Notice,{isDismissible:!1,status:"info",children:"ReBlock can only be embedded as an iFrame for Excelsior Bootstrap."})]})}),(0,u.jsx)("div",{...f,children:B?(0,u.jsx)(l.Notice,{status:"error",isDismissible:!1,children:B}):w?(0,u.jsx)("div",{dangerouslySetInnerHTML:{__html:w.content.rendered}}):0===a?(0,u.jsx)("div",{className:"reblock-select",children:(0,u.jsx)(l.ComboboxControl,{className:"editor-combobox",label:"ReBlock",help:"To prevent direct or indirect circular references (i.e., infinite loops), ReBlock posts that reference this current ReBlock post are excluded from search.",value:y,onChange:H,onFilterValueChange:V,options:j,renderItem:e=>(0,u.jsx)("span",{children:e.label}),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,placeholder:"Search",allowReset:!1,expandOnFocus:!1})}):(0,u.jsxs)("div",{className:"loading-message",children:[(0,u.jsx)("span",{class:"loader"})," Loading..."]})})]})},save:function(){return null}})})();