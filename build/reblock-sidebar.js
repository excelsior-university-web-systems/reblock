(()=>{"use strict";const e=window.wp.plugins,t=window.wp.editor,n=window.wp.components,i=window.wp.data,r=window.wp.element,l=window.wp.coreData,o=window.wp.primitives,s=window.ReactJSXRuntime,d=(0,s.jsx)(o.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)(o.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm-.75 12v-1.5h1.5V16h-1.5Zm0-8v5h1.5V8h-1.5Z"})}),a=()=>{const e=(0,i.useSelect)((e=>e("core/editor").getCurrentPostType()),[]),t=(0,i.useSelect)((t=>t("core").getPostType(e)),[]);return t&&t.viewable};(0,e.registerPlugin)("reblock-usage-tracker",{render:()=>{const e=a(),r=(0,i.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta")||{}),[]),o=Array.isArray(r._reblock_used_in)?r._reblock_used_in:[],c=(0,i.useSelect)((e=>{if(!o.length)return[];const t=o.reduce(((e,{id:t,type:n})=>((e[n]=e[n]||[]).push(t),e)),{});let n=[];for(const[i,r]of Object.entries(t)){const t=e(l.store).getEntityRecords("postType",i,{include:r,per_page:r.length});if(null===t)return;n=n.concat(t)}return n}),[o]);return(0,s.jsx)(t.PluginDocumentSettingPanel,{name:"reblock-usage-panel",title:"ReBlock Usage",className:"reblock-usage-panel",icon:d,initialOpen:!0,children:void 0===c?(0,s.jsx)(n.Spinner,{}):c.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"This ReBlock is used in the following content items. Updates to this ReBlock will affect all listed items."}),(0,s.jsx)("ul",{style:{listStyle:"revert",padding:"revert"},children:c.map((e=>(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",children:e.title.rendered||`#${e.id}`})},e.id)))}),e&&(0,s.jsxs)(n.Notice,{status:"warning",__unstableHTML:!0,isDismissible:!1,children:[(0,s.jsx)("strong",{children:"Warning:"})," This list does not include ReBlock content embedded as an iframe on external sites. Updates to this ReBlock will still apply to those embeds."]})]}):(0,s.jsx)("p",{children:(0,s.jsx)("em",{children:"No references found."})})})},icon:d}),(0,e.registerPlugin)("reblock-embed-meta-box",{render:()=>{const e=(0,i.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),l=(0,i.useSelect)((e=>e("core/editor").getPermalink()),[]);if(!a())return null;const[o,d]=(0,r.useState)(!1),c=`<iframe data-reblock="${e}" style="width: 100%; height: auto; overflow: hidden; border: none;" scrolling="no" src="${l}"></iframe>`;return(0,s.jsxs)(t.PluginDocumentSettingPanel,{name:"reblock-embed",title:"Reblock Embed Code",className:"reblock-embed",initialOpen:!0,children:[(0,s.jsx)(n.TextareaControl,{label:"Embed Code",value:c,readOnly:!0,__nextHasNoMarginBottom:!0}),(0,s.jsx)(n.Button,{variant:"primary",onClick:()=>{navigator.clipboard.writeText(c).then((()=>{d(!0),setTimeout((()=>d(!1)),3e3)}))},disabled:o,style:{marginTop:"6px"},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,children:o?"Copied":"Copy"})]})}})})();