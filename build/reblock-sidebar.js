(()=>{"use strict";const e=window.wp.plugins,t=window.wp.editor,i=window.wp.components,n=window.wp.data,r=window.wp.element,l=window.wp.coreData,o=window.wp.escapeHtml,s=window.wp.primitives,d=window.ReactJSXRuntime,c=(0,d.jsx)(s.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)(s.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm-.75 12v-1.5h1.5V16h-1.5Zm0-8v5h1.5V8h-1.5Z"})}),a=()=>{const e=(0,n.useSelect)(e=>e("core/editor").getCurrentPostType(),[]),t=(0,n.useSelect)(t=>t("core").getPostType(e),[]);return t&&t.viewable};(0,e.registerPlugin)("reblock-usage-tracker",{render:()=>{const e=a(),r=(0,n.useSelect)(e=>e("core/editor").getEditedPostAttribute("meta")||{},[]),o=Array.isArray(r._reblock_used_in)?r._reblock_used_in:[],s=(0,n.useSelect)(e=>{if(!o.length)return[];const t=o.reduce((e,{id:t,type:i})=>((e[i]=e[i]||[]).push(t),e),{});let i=[];for(const[n,r]of Object.entries(t)){const t=e(l.store).getEntityRecords("postType",n,{include:r,per_page:r.length});if(null===t)return;i=i.concat(t)}return i},[o]);return(0,d.jsx)(t.PluginDocumentSettingPanel,{name:"reblock-usage-panel",title:"ReBlock Usage",className:"reblock-usage-panel",icon:c,initialOpen:!0,children:void 0===s?(0,d.jsx)(i.Spinner,{}):s.length?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{children:"This ReBlock is used in the following content items. Updates to this ReBlock will affect all listed items."}),(0,d.jsx)("ul",{style:{listStyle:"revert",padding:"revert"},children:s.map(e=>(0,d.jsx)("li",{children:(0,d.jsx)("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",children:e.title.rendered||`#${e.id}`})},e.id))}),e&&(0,d.jsxs)(i.Notice,{status:"warning",__unstableHTML:!0,isDismissible:!1,children:[(0,d.jsx)("strong",{children:"Warning:"})," This list does not include ReBlock content embedded as an iframe on external sites. Updates to this ReBlock will still apply to those embeds."]})]}):(0,d.jsx)("p",{children:(0,d.jsx)("em",{children:"No references found."})})})},icon:c}),(0,e.registerPlugin)("reblock-embed-meta-box",{render:()=>{const e=(0,n.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),l=(0,n.useSelect)(e=>e("core/editor").getEditedPostAttribute("title"),[]),s=(0,n.useSelect)(e=>e("core/editor").getPermalink(),[]);if(!a())return null;const[c,u]=(0,r.useState)(!1),p=`<div><iframe title="${(0,o.escapeAttribute)(l)}" data-reblock="${e}" style="width: 100%; height: auto; overflow: hidden; border: none;" scrolling="no" src="${s}"></iframe></div>`;return(0,d.jsxs)(t.PluginDocumentSettingPanel,{name:"reblock-embed",title:"Reblock Embed Code",className:"reblock-embed",initialOpen:!0,children:[(0,d.jsx)(i.TextareaControl,{label:"Embed Code",value:p,readOnly:!0,__nextHasNoMarginBottom:!0}),(0,d.jsx)(i.Button,{variant:"primary",onClick:()=>{navigator.clipboard.writeText(p).then(()=>{u(!0),setTimeout(()=>u(!1),3e3)})},disabled:c,style:{marginTop:"6px"},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,children:c?"Copied":"Copy"})]})}})})();